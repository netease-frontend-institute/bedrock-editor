(self.webpackChunk_ehr_ui_bedrock_editor=self.webpackChunk_ehr_ui_bedrock_editor||[]).push([[433],{79292:function(K,m,n){"use strict";n.r(m);var R=n(3952),P=n(93236),h=n(62086);m.default=function(){return(0,h.jsx)(R.ML,{})}},19847:function(K,m,n){"use strict";n.r(m);var R=n(3952),P=n(93236),h=n(62086),y='<p><span style="font-size:16px"><strong>\u5DE5\u5177\u5F00\u53D1\uFF1A</strong></span></p><p>V0.0.2\u7248\u672C\u4EA4\u4E92\u7A3F\u786E\u8BA4\uFF0C\u672C\u5468\u542F\u52A8\u4EA4\u4E92\u8BC4\u5BA1</p><p></p><p><span style="font-size:16px"><strong>\u914D\u97F3\u5DE5\u5177\u4E1A\u52A1\u589E\u957F\uFF1A</strong></span></p><p style="text-indent:2em;">\u5916\u90E8\u6E38\u620F\u5BA2\u6237\u5DF2\u62A5\u4EF7\uFF0C\u5DE5\u5177</p><p style="text-indent:2em;">\u4E60\u8FD1\u5E73\u603B\u4E66\u8BB0\u80AF\u5B9A\u4E86\u201C\u4E00\u5E26\u4E00\u8DEF</p><p style="text-indent:2em;">\u5B9E\u73B0\u4E86\u540C\u5171\u5EFA\u56FD\u5BB6\u4E92\u5229\u5171\u8D62</p><p style="text-indent:2em;"><span style="font-size:14px">\u5171\u5EFA\u2018\u4E00\u5E26\u4E00\u8DEF\u2019\uFF0C\u63D0\u9AD8\u4E86\u56FD\u5185\u5404\u533A\u57DF\u5F00\u653E\u6C34\u5E73\uFF0C\u62D3\u5C55\u4E86\u5BF9\u5916\u5F00\u653E\u9886\u57DF\uFF0C\u63A8\u52A8\u4E86\u5236\u5EA6\u578B\u5F00</span><br/></p>';m.default=function(){return(0,h.jsx)(R.ML,{initialHtml:y})}},29341:function(K,m,n){"use strict";n.r(m);var R=n(54306),P=n.n(R),h=n(93236),y=n(3952),M=n(77735),j=n(62086);m.default=function(){var _=(0,h.useRef)(null),F=(0,h.useState)(),w=P()(F,2),J=w[0],T=w[1],E=(0,h.useState)(""),oe=P()(E,2),G=oe[0],ie=oe[1],Q=function(q){var B;T(q),ie((B=_.current)===null||B===void 0?void 0:B.convertToHTML(q))};return(0,j.jsx)(M.Z,{type:"card",destroyInactiveTabPane:!0,items:[{key:"1",label:"\u7F16\u8F91\u6A21\u5F0F",children:(0,j.jsx)(y.ML,{ref:_,onChange:Q,editorState:J})},{key:"2",label:"\u5C55\u793A\u6A21\u5F0F",children:(0,j.jsx)(y.Pq,{content:G})}]})}},74073:function(K,m,n){"use strict";n.r(m);var R=n(3952),P=n(93236),h=n(62086);m.default=function(){return(0,h.jsx)(R.ML,{config:{getPlugins:function(M){return console.log("plugins",M),M.splice(5,1),M.push((0,R.Hn)()),M}}})}},92627:function(K,m,n){"use strict";n.r(m);var R=n(93236),P=n(3952),h=n(62086),y=function(j){return`<div style="width: 750px; margin: 0 auto;">
<div style="min-height: 128px; background-image: url(https://nos.netease.com/rms/7cf241cf1fb0b61f07d29dca9dce75cf); background-repeat: no-repeat; background-size: cover;">
<div style="padding: 70px 55px 0; overflow: hidden; font-size: 24px; color: #FFF; text-overflow: ellipsis; word-wrap: normal; white-space: nowrap; ">
<strong>\u90AE\u4EF6\u6807\u9898</strong>
</div></div><div style="padding: 20px 55px; background-color: #A00405;"><div style="padding: 30px; background-color: #FFF; border-radius: 10px;">`.concat(j,'</div></div><div style="height: 95px; background-image: url(https://nos.netease.com/rms/b2a0bcacab15a20508de56e0d69eedc4); background-repeat: no-repeat; background-size: cover;"></div></div>')};m.default=function(){return(0,h.jsx)(P.ML,{previewProps:{customPreview:y}})}},52380:function(K,m,n){"use strict";n.r(m);var R=n(93236),P=n(3881),h=n(3952),y=n(62086);m.default=function(){var M=(0,R.useRef)(null),j=function(){var F=M.current.editorRef,w=M.current.convertToHTML(F.getEditorState());console.log("htmlStr",w)};return(0,y.jsxs)("div",{children:[(0,y.jsx)(h.ML,{ref:M}),(0,y.jsx)(P.ZP,{onClick:j,children:"\u63D0\u4EA4"})]})}},6211:function(K,m,n){"use strict";n.r(m);var R=n(3952),P=n(93236),h=n(62086),y=[{id:1,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:2,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:3,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:4,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:5,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:6,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:7,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:8,fieldName:"\u5E94\u8058\u90E8\u95E8"}];m.default=function(){return(0,h.jsx)(R.ML,{tagList:y})}},3952:function(K,m,n){"use strict";n.d(m,{ML:function(){return me},Pq:function(){return fe},Hn:function(){return E.Hn}});var R=n(57213),P=n.n(R),h=n(25359),y=n.n(h),M=n(49811),j=n.n(M),_=n(54306),F=n.n(_),w=n(12342),J=n.n(w),T=n(93236),E=n(79285),oe=n(50958),G=n(60658),ie=n(47899),Q=n.n(ie),ae=n(93614),q=n(63466),B=n.n(q),Ce=n(21140),ue=n.n(Ce),Ne=n(68608),U=n.n(Ne),Se=n(58853),le=n.n(Se),xe=n(38888),de=n.n(xe),Re=n(52510),k=n.n(Re),Te=n(996),jt=n(27120),be=n(49290),Me=n.n(be),Ie=n(78017),Le=n.n(Ie),je=n(44908),Oe=n.n(je),S=n(62086),Ue=function(i){var r=i.node,t=r.attrs,u=t.name;return(0,S.jsx)("span",{className:"keyword-item",children:u})};function ke(){return function(c){le()(r,c);var i=de()(r);function r(t,u,e,o){return ue()(this,r),i.call(this,t,u,e,o)}return B()(r,[{key:"createDOMElement",value:function(){var u=document.createElement("span");return u}},{key:"update",value:function(u,e){var o=Le()(Oe()(r.prototype),"update",this).call(this,u,e);return o&&!0}},{key:"renderReactComponent",value:function(){return(0,S.jsx)(Ue,P()({},this.props))}}]),r}(E.rr)}var Ke=ke,De={attrs:{name:{default:""}},inline:!0,group:"inline",draggable:!0,toDOM:function(i){var r=i.attrs.name;return["span",{class:"keyword-item"},"".concat(r)]},parseDOM:[{tag:"span.keyword-item",getAttrs:function(i){var r=i.textContent;return{name:r}}}]};function Ae(){return new E.$n({key:new E.H$("tag"),nodeSpecs:{tag:De},nodeViews:{tag:Ke()}})}var ce=Ae,ze=function(i,r){var t=i.className,u=i.style,e=i.content,o=i.beforeRenderContent,a=i.useZmage,d=a===void 0?!0:a,l=i.usePopoLink,s=l===void 0?!0:l,g=i.useTagList,p=(0,T.useRef)(null);(0,T.useImperativeHandle)(r,function(){return{element:p.current}});var C=o?o(e):e,f=function(I){I.persist(),d&&I.target.localName==="img"&&Me().browsing({src:I.target.currentSrc,backdrop:"rgba(0, 0, 0, 0.5)"})};(0,T.useEffect)(function(){if(p.current&&s){var x=p.current.querySelectorAll(".popo-link-node-body");x.forEach(function(I){var X=I.getAttribute("data-email");X&&I.addEventListener("click",function(){window.open("http://popo.netease.com/static/html/open_popo.html?ssid=".concat(X,"&sstp=0"))})})}},[C,s]);var v=function(I){return g&&I.push(ce()),I};return(0,S.jsx)("div",{onClick:f,ref:p,className:t,children:(0,S.jsx)(me,{initialHtml:C,readOnly:!0,isHideToolbar:!0,config:{getPlugins:v},style:u||{}})})},fe=(0,T.forwardRef)(ze),Fe=T.forwardRef(function(c){var i=c.content,r=c.onCancel,t=c.isCustomPreview,u=c.useTagList,e=c.wrapRef;return(0,S.jsx)(Te.Z,{title:"\u9884\u89C8",visible:!0,scrolled:!0,footer:null,onCancel:r,className:"popo-public-editor-preview-modal",destroyOnClose:!0,width:1e3,getContainer:function(){return e==null?void 0:e.getEditorDom()},children:t?(0,S.jsx)("div",{dangerouslySetInnerHTML:{__html:i},className:"rock-editor__renderer"}):(0,S.jsx)(fe,{useZmage:!1,content:i,useTagList:u,className:"rock-editor__renderer"})})}),we=Fe,Be=function(c){le()(r,c);var i=de()(r);function r(t,u){var e,o,a,d,l,s;return ue()(this,r),s=i.call(this),k()(U()(s),"name","Preview"),k()(U()(s),"useTagList",!1),k()(U()(s),"_popUp",null),k()(U()(s),"customPreview",void 0),k()(U()(s),"ref",void 0),k()(U()(s),"isEnabled",function(){return!0}),k()(U()(s),"waitForUserInput",function(g){return s._popUp?Promise.resolve(void 0):new Promise(function(p){var C;s._popUp=(0,E.wo)(we,{wrapRef:(C=s.ref)===null||C===void 0?void 0:C.current,isCustomPreview:!!s.customPreview,useTagList:s.useTagList,content:s.customPreview?s.customPreview((0,E.cn)(g)):(0,E.cn)(g),onOk:function(v){p(v),s._popUp.destroy(),s._popUp=null},onCancel:function(){p(void 0),s._popUp.destroy(),s._popUp=null}})})}),k()(U()(s),"executeWithUserInput",function(g,p,C,f){return!0}),s.icon=t,s.tooltip=(e=u.tooltip)!==null&&e!==void 0?e:{},s.desc=(o=u.desc)!==null&&o!==void 0?o:{},s.customPreview=(a=u.customPreview)!==null&&a!==void 0?a:null,s.useTagList=(d=u.useTagList)!==null&&d!==void 0?d:!1,s.ref=(l=u.ref)!==null&&l!==void 0?l:null,s}return B()(r)}(E.YY),He=Be,We=function(i){var r=new He((0,S.jsx)(ae.Z,{}),{tooltip:{"zh-CN":"\u9884\u89C8","en-US":"Preview"},customPreview:i==null?void 0:i.customPreview,useTagList:i==null?void 0:i.useTagList,ref:i==null?void 0:i.ref});return r},$e=We;function Ze(c){var i=c||{},r=i.customPreview,t=i.useTagList,u=i.ref;return new E.$n({key:new E.H$("preview"),getToolbarConfig:function(o){return o[o.length-1].push($e({customPreview:r,useTagList:t,ref:u})),o}})}var Ve=Ze,_e=n(99669),Ge=n(7346);function ve(c,i){for(var r=c.nextSibling;r;){if(r.classList.contains(i))return r;r=r.nextSibling}return null}var Xe=function(i){var r=i.tagList,t=i.onClick,u=i.isReady,e=(0,T.useRef)(null),o=function(){var d,l=ve(e.current,"rock-editor");if(l){var s=l.querySelector(".rock-editor__toolbar");if(s){var g=(d=e.current)===null||d===void 0?void 0:d.offsetHeight;if(g){var p=ve(s,"prosemirror-wrapper");p&&(p.style.marginTop="".concat(g,"px"))}}}};return(0,T.useEffect)(function(){return u&&o(),window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}},[u]),(0,S.jsx)("div",{className:"rock-editor-tag-extra-container",ref:e,children:(0,S.jsxs)(_e.Z,{wrap:!0,children:["\u53EF\u9009\u5B57\u6BB5:",r==null?void 0:r.map(function(a){var d=a.id,l=a.fieldName;return(0,S.jsx)(Ge.Z,{text:l,size:"small",onClick:function(){return t(a)}},d)})]})})},Ye=Xe,Ot=n(73989),Ut=n(34668),Je=n(79935),b=n.n(Je),Qe="https://netease-frontend-institute.github.io",qe="https://ehr-service.netease.com",ge=location.origin===Qe?qe:location.origin,et=function(i){var r=i.nosKey,t=i.bucketName,u=i.fileName,e=i.nosUrl;return new Promise(function(o,a){b().ajax({type:"get",url:"".concat(ge).concat(e),data:{nosKey:r,bucketName:t,fileName:encodeURIComponent(u),fileNameEncode:"URL_ENCODE"},success:function(l){return l.code===200?o(l.data):a()},error:a})})},tt=function(i){var r=i.uploader,t=i.param,u=i.nosKey,e=i.bucketName,o=i.nosUrl;return new Promise(function(a,d){r.upload(t,function(l){et({nosKey:u,bucketName:e,fileName:l.fileName,nosUrl:o}).then(function(s){a(s)}).catch(function(s){d(s)})})})},rt=function(i){var r=i.uploader,t=i.file,u=i.nosKey,e=i.bucketName,o=i.token,a=i.trunkSize,d=i.nosUrl;return new Promise(function(l){r.addFile(t,j()(y()().mark(function s(){var g,p;return y()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return g={bucketName:e,objectName:u,token:o,trunkSize:a},f.next=3,tt({uploader:r,param:g,nosKey:u,bucketName:e,nosUrl:d});case 3:p=f.sent,l(p);case 5:case"end":return f.stop()}},s)})))})},nt=function(){var c=j()(y()().mark(function i(r){var t,u,e;return y()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.email,t){a.next=3;break}return a.abrupt("return",Promise.reject("no email"));case 3:return a.next=5,fetch("https://bedrock.netease.com:8010/api/bedrock/getPopoName?email=".concat(t));case 5:return u=a.sent,a.next=8,u.json();case 8:return e=a.sent,a.abrupt("return",e);case 10:case"end":return a.stop()}},i)}));return function(r){return c.apply(this,arguments)}}(),ot=function(i){return"https://unpkg.oa.netease.com/@bedrock/static/emoji-big/".concat(i)};function it(c){if(!c)return c;var i=document.createElement("div");i.innerHTML=c;for(var r=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT),t=r.nextNode();t;){var u=t.getAttribute("style");if(u&&!t.hasAttribute("data-indent")){var e=/text-indent:\s*(\d+)em;/i.exec(u);if(e){var o=parseInt(e[1],10)/2;t.setAttribute("data-indent","".concat(o,"em"))}}t=r.nextNode()}return i.innerHTML}var kt=n(56154);function st(c){"use strict";var i={protocol:location.protocol||"https:",urlDns:"http://wanproxy.127.net/lbs",retryCount:2,fileInputID:"fileInput",timeout:5e4,onError:function(e){console.log(e)},onProgress:function(e){console.log(e.status),console.log(e.progress)}},r,t;return r=b().extend({},i,c),t={version:"1.0",uploadFile:null,edgeNodeList:null,dnsRetryCount:0,uTRetryCount:r.retryCount,gORetryCount:r.retryCount,gDRetryCount:r.retryCount,createAjax:function(){var e={};return window.XMLHttpRequest&&(e=new XMLHttpRequest),e},clearStorage:function(e,o,a){localStorage.removeItem(a+"_progress"),localStorage.removeItem(a+"_"+e+"_"+o+"_context")},addFile:function(e,o){if(e){var a=Q()(e.name+":"+e.size).toString(),d;d={fileKey:a,file:e,fileName:e.name,status:0,progress:localStorage.getItem(a+"_progress")||0},t.uploadFile&&(t.uploadFile=null),t.uploadFile=b().extend(!0,{},d),o&&o(d)}},getFile:function(e){var o;return t.uploadFile.fileKey===e&&(o=t.uploadFile),o},getDNS:function(e,o){if((e==null||e==="")&&(e=""),t.edgeNodeList)o(t.edgeNodeList);else if(r.protocol==="https:"){var a=["https://wanproxy-web.127.net"];t.edgeNodeList=a,o(a,r.urlDns)}else b().ajax({type:"get",url:r.urlDns,data:{version:t.version,bucketname:e},dataType:"json",success:function(l){l.code?r.onError({errCode:l.Code,errMsg:l.Message}):(t.edgeNodeList=l.upload,o(l.upload,l.lbs))},error:function(l){l.status.toString().match(/^5/)&&t.gDRetryCount>0&&t.gDRetryCount<r.retryCount+1?(t.getDNS(e,o),t.gDRetryCount--):(r.onError(l.responseText),t.gDRetryCount=r.retryCount)}})},getOffset:function(e,o){var a;if(a=localStorage.getItem(e.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),!a)return o(0);b().ajax({type:"get",url:e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+"?uploadContext",data:{version:t.version,context:a},dataType:"json",beforeSend:function(l){l.setRequestHeader("x-nos-token",e.token)},success:function(l){l.errCode?r.onError({errCode:l.errCode,errMsg:l.errMsg}):o(l.offset)},error:function(l){l.status.toString().match(/^5/)&&t.gORetryCount>0&&t.gORetryCount<r.retryCount+1?(t.getOffset(e,o),t.gORetryCount--):(r.onError(l.responseText),t.gORetryCount=r.retryCount,l.status===404&&t.clearStorage(e.bucketName,e.objectName,e.fileKey))}})},uploadTrunk:function(e,o,a){var d,l="",s,g,p=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(s=t.getFile(o.fileKey),g=localStorage.getItem(o.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),s.xhr?d=s.xhr:(d=t.createAjax(),s.xhr=d),d.upload.onprogress=function(f){var v=0;f.lengthComputable?(v=(o.offset+f.loaded)/o.file.size,s.progress=(v*100).toFixed(2),v>0&&v<1?(s.status=1,b()("#"+r.fileInputID).attr("disabled",!0)):v===1&&(s.status=2,b()("#"+r.fileInputID).attr("disabled",!1)),localStorage.setItem(o.fileKey+"_progress",s.progress),r.onProgress(s)):(console.log("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6",f),r.onError({errMsg:"\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6"}))},d.onreadystatechange=function(){if(d.readyState===4){var f;try{f=JSON.parse(d.responseText)}catch(x){f={errMsg:"\u672A\u77E5\u9519\u8BEF"}}if(d.status===200)s.file.size===0&&(s.status=2,s.progress=100,r.onProgress(s)),localStorage.setItem(o.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context",f.context),f.offset<o.file.size?t.uploadTrunk(e,b().extend({},o,{offset:f.offset,trunkEnd:f.offset+o.trunkSize,context:g||f.context}),a):a(o);else if(d.status.toString().match(/^5/))if(t.uTRetryCount<r.retryCount+1&&t.uTRetryCount>0)t.getOffset({serveIp:e.serveIp,bucketName:e.bucketName,objectName:e.objectName,token:e.token,fileKey:o.fileKey},function(x){t.uploadTrunk(e,b().extend({},o,{offset:x,trunkEnd:x+o.trunkSize,context:localStorage.getItem(o.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)}),t.uTRetryCount--;else if(t.dnsRetryCount<t.edgeNodeList.length-1){t.uTRetryCount=r.retryCount,t.dnsRetryCount++;var v=b().extend({},e,{serveIp:t.edgeNodeList[t.dnsRetryCount]});t.getOffset({serveIp:v.serveIp,bucketName:v.bucketName,objectName:v.objectName,token:v.token,fileKey:o.fileKey},function(x){t.uploadTrunk(v,b().extend({},o,{offset:x,trunkEnd:x+o.trunkSize,context:localStorage.getItem(o.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)})}else t.dnsRetryCount=0,r.onError({errCode:f.errCode,errMsg:f.errMsg}),b()("#"+r.fileInputID).attr("disabled",!1),t.clearStorage(e.bucketName,e.objectName,o.fileKey);else b()("#"+r.fileInputID).attr("disabled",!1),d.status&&(t.clearStorage(e.bucketName,e.objectName,o.fileKey),r.onError({errCode:f.errCode,errMsg:f.errMsg}))}},l="?offset="+o.offset+"&complete="+(o.trunkEnd>=o.file.size)+"&context="+(g||o.context)+"&version="+t.version,d.open("post",e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+l),d.timeout=r.timeout,d.setRequestHeader("x-nos-token",e.token),navigator.userAgent.indexOf("WindowsWechat")>=0){var C=new FileReader;C.addEventListener("loadend",function(){var f=new Blob([C.result]);d.send(f)}),C.readAsArrayBuffer(p.call(o.file,o.offset,o.trunkEnd))}else d.send(p.call(o.file,o.offset,o.trunkEnd))},pauseUpload:function(){var e;t.uploadFile?t.uploadFile.xhr?t.uploadFile.status<2&&(e=t.uploadFile.xhr,e.abort(),b()("#"+r.fileInputID).attr("disabled",!1)):r.onError({errMsg:"\u5F53\u524D\u6587\u4EF6\u672A\u5F00\u59CB\u4E0A\u4F20"}):r.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"})},upload:function(e,o){if(!e.bucketName&&e.bucketName!==0){r.onError({errMsg:"\u6876\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.objectName&&e.objectName!==0){r.onError({errMsg:"\u5BF9\u8C61\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.token){r.onError({errMsg:"\u4E0A\u4F20\u51ED\u8BC1\u4E0D\u80FD\u4E3A\u7A7A"});return}if(e.trunkSize?Object.prototype.toString.call(e.trunkSize)==="[object String]"&&(e.trunkSize=parseInt(e.trunkSize)):e.trunkSize=128*1024,!t.uploadFile){r.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"});return}var a=t.uploadFile;t.getDNS(e.bucketName,function(d){if(d.length===0){r.onError({errMsg:"\u6682\u65E0\u8FB9\u7F18\u8282\u70B9"});return}t.getOffset({serveIp:d[0],bucketName:e.bucketName,objectName:e.objectName,fileKey:a.fileKey,token:e.token},function(l){t.uploadTrunk({serveIp:d[0],bucketName:e.bucketName,objectName:e.objectName,token:e.token},{file:a.file,fileKey:a.fileKey,offset:l||0,trunkSize:e.trunkSize,trunkEnd:(l||0)+e.trunkSize,context:""},function(s){t.clearStorage(e.bucketName,e.objectName,s.fileKey),o&&o(a)})})})}},t}var at=st,ut=["config","initialHtml","tagList","onChange","uploadProps","previewProps","onReady"],lt=["features","getPlugins"],dt=500*1024*1024,ct=4*1024*1024;function ft(c,i){var r=c.config,t=c.initialHtml,u=c.tagList,e=c.onChange,o=c.uploadProps,a=c.previewProps,d=c.onReady,l=J()(c,ut),s=o||{},g=s.maxSize,p=g===void 0?dt:g,C=s.beforeUpload,f=s.nosTokenUrl,v=f===void 0?"/api/file/nos/token":f,x=s.bucketName,I=x===void 0?"rms":x,X=s.trunkSize,vt=X===void 0?ct:X,pe=s.nosUrl,gt=pe===void 0?"/api/file/nos/url":pe,se=r||{},mt=se.features,ye=se.getPlugins,pt=J()(se,lt),yt=a||{},Et=yt.customPreview,Pt=(0,T.useState)(!1),Ee=F()(Pt,2),ht=Ee[0],Ct=Ee[1],Nt=(0,T.useState)(),Pe=F()(Nt,2),St=Pe[0],xt=Pe[1],D=(0,T.useRef)(null);(0,T.useImperativeHandle)(i,function(){return{editorRef:D.current,convertToHTML:E.cn}});var Rt=function(){var H=j()(y()().mark(function N(O,A){var W,$,z,ee,Y,Z,te,V,re,ne,he;return y()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(W=A.onProgress,O){L.next=3;break}return L.abrupt("return",Promise.reject("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"));case 3:return $=0,z=setInterval(function(){$+=1,W($),$>=90&&clearInterval(z)},100),ee=O.size,Y=O.name,Z=Q()(Y+":"+ee+":"+new Date().getTime()).toString(),L.next=9,fetch("".concat(ge).concat(v,"?nosKey=").concat(Z,"&bucketName=").concat(I));case 9:return te=L.sent,L.next=12,te.json();case 12:return V=L.sent,re=V.data,ne=at({onError:function(){G.ZP.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25")}}),L.next=17,rt({uploader:ne,file:O,nosKey:Z,bucketName:I,token:re,nosUrl:gt,trunkSize:vt});case 17:return he=L.sent,L.abrupt("return",{src:he});case 19:case"end":return L.stop()}},N)}));return function(O,A){return H.apply(this,arguments)}}(),Tt=function(N){return N.name.length>100?(G.ZP.error("\u6587\u4EF6\u540D\u8FC7\u957F\uFF08\u9700\u63A7\u5236\u5728100\u5B57\u7B26\u5185\uFF09"),!1):N.size>p?(G.ZP.error("\u6587\u4EF6\u8FC7\u5927"),!1):C?C(N):!0},bt=P()(P()({features:P()({invertWhenPasteSimilarColor:{enable:!0,threshold:.1},fontSize:!0,image:{singleButton:!0,allowEdit:!0},fullScreen:!0},mt||{}),beforeImageUpload:Tt,uploadImage:Rt},pt),{},{getPlugins:function(){var N=[(0,E._C)({getPopoName:nt}),(0,E.YV)(),(0,E.SN)(),Ve({customPreview:Et,ref:D,useTagList:!!(u!=null&&u.length)}),(0,E._8)(),(0,E.hF)({insertAfter:"IndentDropdown"}),(0,E.zF)({covertNameToSrc:ot,insertAfter:"TextBgPicker"})];return u&&N.push(ce()),ye?ye(N):N}}),Mt=function(N){var O,A,W,$=(O=D.current)===null||O===void 0?void 0:O.getEditorState(),z=D==null||(A=D.current)===null||A===void 0||(W=A.getEditorView)===null||W===void 0?void 0:W.call(A),ee=z||{},Y=ee.dispatch;if(Y){var Z=$||{},te=Z.schema,V=Z.tr,re=te.nodes.tag,ne=re.create({name:N.fieldName},null,void 0);V=V.replaceSelectionWith(ne),Y(V)}z==null||z.focus()},It=function(N){Ct(!0),d==null||d(N)},Lt=function(N,O){xt(N),e==null||e(N,O)};return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{className:"bedrock-editor-wrapper",children:[!!u&&(0,S.jsx)(Ye,{tagList:u,onClick:Mt,isReady:ht}),(0,S.jsx)(E.ZP,P()(P()({autoFocus:!0},l),{},{editorState:St,onChange:Lt,ref:D,style:P()({"--r-editor-content-font-size":"14px","--r-editor-content-min-height":"240px","--r-editor-content-color":"#333","--text-color-1":"#333","--primary-1":"#1890ff","--br60":"#1890ff"},(l==null?void 0:l.style)||{}),config:bt,onReady:It,initialHtml:it(t)}))]})})}var me=(0,T.forwardRef)(ft),Kt=function(i,r){var t=i.className,u=i.style,e=i.content,o=i.beforeRenderContent,a=i.useZmage,d=a===void 0?!0:a,l=i.usePopoLink,s=l===void 0?!0:l,g=useRef(null);useImperativeHandle(r,function(){return{element:g.current}});var p=o?o(e):e,C=function(v){v.persist(),d&&v.target.localName==="img"&&Zmage.browsing({src:v.target.currentSrc,backdrop:"rgba(0, 0, 0, 0.5)"})};return useEffect(function(){if(g.current&&s){var f=g.current.querySelectorAll(".popo-link-node");f.forEach(function(v){var x=v.getAttribute("data-email");x&&v.addEventListener("click",function(){window.open("http://popo.netease.com/static/html/open_popo.html?ssid=".concat(x,"&sstp=0"))})})}},[p,s]),_jsx("div",{ref:g,className:"rock-editor__renderer ".concat(t),style:_objectSpread(_objectSpread({},u||{}),{},{"--text-color-1":"#333"}),onClick:C,dangerouslySetInnerHTML:{__html:p}})},Dt=null},86010:function(){}}]);
