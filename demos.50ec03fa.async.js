(self.webpackChunk_ehr_ui_bedrock_editor=self.webpackChunk_ehr_ui_bedrock_editor||[]).push([[433],{79292:function(D,m,r){"use strict";r.r(m);var C=r(89379),y=r(93236),h=r(62086);m.default=function(){return(0,h.jsx)(C.ML,{})}},19847:function(D,m,r){"use strict";r.r(m);var C=r(89379),y=r(93236),h=r(62086),p='<p><span style="font-size:16px"><strong>\u5DE5\u5177\u5F00\u53D1\uFF1A</strong></span></p><p>V0.0.2\u7248\u672C\u4EA4\u4E92\u7A3F\u786E\u8BA4\uFF0C\u672C\u5468\u542F\u52A8\u4EA4\u4E92\u8BC4\u5BA1</p><p></p><p><span style="font-size:16px"><strong>\u914D\u97F3\u5DE5\u5177\u4E1A\u52A1\u589E\u957F\uFF1A</strong></span></p><p style="text-indent:2em;">\u5916\u90E8\u6E38\u620F\u5BA2\u6237\u5DF2\u62A5\u4EF7\uFF0C\u5DE5\u5177</p><p style="text-indent:2em;">\u4E60\u8FD1\u5E73\u603B\u4E66\u8BB0\u80AF\u5B9A\u4E86\u201C\u4E00\u5E26\u4E00\u8DEF</p><p style="text-indent:2em;">\u5B9E\u73B0\u4E86\u540C\u5171\u5EFA\u56FD\u5BB6\u4E92\u5229\u5171\u8D62</p><p style="text-indent:2em;"><span style="font-size:14px">\u5171\u5EFA\u2018\u4E00\u5E26\u4E00\u8DEF\u2019\uFF0C\u63D0\u9AD8\u4E86\u56FD\u5185\u5404\u533A\u57DF\u5F00\u653E\u6C34\u5E73\uFF0C\u62D3\u5C55\u4E86\u5BF9\u5916\u5F00\u653E\u9886\u57DF\uFF0C\u63A8\u52A8\u4E86\u5236\u5EA6\u578B\u5F00</span><br/></p>';m.default=function(){return(0,h.jsx)(C.ML,{initialHtml:p})}},29341:function(D,m,r){"use strict";r.r(m);var C=r(54306),y=r.n(C),h=r(93236),p=r(89379),x=r(43665),M=r(62086),$=x.Z.TabPane;m.default=function(){var K=(0,h.useRef)(null),_=(0,h.useState)(),Z=y()(_,2),b=Z[0],P=Z[1],V=(0,h.useState)(""),re=y()(V,2),ne=re[0],J=re[1],oe=function(G){var X;P(G),J((X=K.current)===null||X===void 0?void 0:X.convertToHTML(G))};return(0,M.jsxs)(x.Z,{type:"card",destroyInactiveTabPane:!0,children:[(0,M.jsx)($,{tab:"\u7F16\u8F91\u6A21\u5F0F",children:(0,M.jsx)(p.ML,{ref:K,onChange:oe,editorState:b})},1),(0,M.jsx)($,{tab:"\u5C55\u793A\u6A21\u5F0F",children:(0,M.jsx)(p.Pq,{content:ne})},2)]})}},48399:function(D,m,r){"use strict";r.r(m);var C=r(89379),y=r(93236),h=r(62086);m.default=function(){var p=[{id:1,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:2,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:3,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:4,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:5,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:6,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:7,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:8,fieldName:"\u5E94\u8058\u90E8\u95E8"}];return(0,h.jsx)(C.ML,{locale:"en",tagList:p})}},74073:function(D,m,r){"use strict";r.r(m);var C=r(89379),y=r(93236),h=r(62086);m.default=function(){return(0,h.jsx)(C.ML,{config:{getPlugins:function(x){return console.log("plugins",x),x.splice(5,1),x.push((0,C.Hn)()),x}}})}},92627:function(D,m,r){"use strict";r.r(m);var C=r(93236),y=r(89379),h=r(62086),p=function(M){return`<div style="width: 750px; margin: 0 auto;">
<div style="min-height: 128px; background-image: url(https://nos.netease.com/rms/7cf241cf1fb0b61f07d29dca9dce75cf); background-repeat: no-repeat; background-size: cover;">
<div style="padding: 70px 55px 0; overflow: hidden; font-size: 24px; color: #FFF; text-overflow: ellipsis; word-wrap: normal; white-space: nowrap; ">
<strong>\u90AE\u4EF6\u6807\u9898</strong>
</div></div><div style="padding: 20px 55px; background-color: #A00405;"><div style="padding: 30px; background-color: #FFF; border-radius: 10px;">`.concat(M,'</div></div><div style="height: 95px; background-image: url(https://nos.netease.com/rms/b2a0bcacab15a20508de56e0d69eedc4); background-repeat: no-repeat; background-size: cover;"></div></div>')};m.default=function(){return(0,h.jsx)(y.ML,{previewProps:{customPreview:p}})}},52380:function(D,m,r){"use strict";r.r(m);var C=r(93236),y=r(83416),h=r(89379),p=r(62086);m.default=function(){var x=(0,C.useRef)(null),M=function(){var K=x.current.editorRef,_=x.current.convertToHTML(K.getEditorState());console.log("htmlStr",_)};return(0,p.jsxs)("div",{children:[(0,p.jsx)(h.ML,{ref:x}),(0,p.jsx)(y.Z,{onClick:M,children:"\u63D0\u4EA4"})]})}},6211:function(D,m,r){"use strict";r.r(m);var C=r(89379),y=r(93236),h=r(62086),p=[{id:1,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:2,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:3,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:4,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:5,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:6,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:7,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:8,fieldName:"\u5E94\u8058\u90E8\u95E8"}];m.default=function(){return(0,h.jsx)(C.ML,{tagList:p})}},89379:function(D,m,r){"use strict";r.d(m,{ML:function(){return me},Pq:function(){return ce},Hn:function(){return P.Hn}});var C=r(57213),y=r.n(C),h=r(25359),p=r.n(h),x=r(49811),M=r.n(x),$=r(54306),K=r.n($),_=r(12342),Z=r.n(_),b=r(93236),P=r(1302),V=r(93782),re=r(50958),ne=r(47899),J=r.n(ne),oe=r(93614),ae=r(63466),G=r.n(ae),X=r(21140),se=r.n(X),Le=r(68608),O=r.n(Le),Re=r(58853),le=r.n(Re),Me=r(38888),ue=r.n(Me),be=r(52510),U=r.n(be),Ie=r(996),At=r(87351),je=r(78017),Oe=r.n(je),Ue=r(44908),De=r.n(Ue),S=r(62086),Ke=function(o){var n=o.node,t=n.attrs,s=t.name;return(0,S.jsx)("span",{className:"keyword-item",children:s})};function Ae(){return function(c){le()(n,c);var o=ue()(n);function n(t,s,e,i){return se()(this,n),o.call(this,t,s,e,i)}return G()(n,[{key:"createDOMElement",value:function(){var s=document.createElement("span");return s}},{key:"update",value:function(s,e){var i=Oe()(De()(n.prototype),"update",this).call(this,s,e);return i&&!0}},{key:"renderReactComponent",value:function(){return(0,S.jsx)(Ke,y()({},this.props))}}]),n}(P.rr)}var Fe=Ae,ze={attrs:{name:{default:""}},inline:!0,group:"inline",draggable:!0,toDOM:function(o){var n=o.attrs.name;return["span",{class:"keyword-item"},"".concat(n)]},parseDOM:[{tag:"span.keyword-item",getAttrs:function(o){var n=o.textContent;return{name:n}}}]};function ke(){return new P.$n({key:new P.H$("tag"),nodeSpecs:{tag:ze},nodeViews:{tag:Fe()}})}var de=ke,we=function(o,n){var t=o.className,s=o.style,e=o.content,i=o.beforeRenderContent,a=o.useTagList,u=(0,b.useRef)(null);(0,b.useImperativeHandle)(n,function(){return{element:u.current}});var d=i?i(e):e,v=function(E){return a&&E.push(de()),E};return(0,S.jsx)("div",{className:t,children:(0,S.jsx)(me,{initialHtml:d,readOnly:!0,isHideToolbar:!0,config:{getPlugins:v},style:s||{}})})},ce=(0,b.forwardRef)(we),We=b.forwardRef(function(c){var o,n=c.content,t=c.onCancel,s=c.isCustomPreview,e=c.useTagList,i=c.wrapRef,a=c.uiLocale,u=a===void 0?{}:a;return(0,S.jsx)(Ie.Z,{title:((o=u.PreviewPlugin)===null||o===void 0?void 0:o.preview)||"\u9884\u89C8",visible:!0,scrolled:!0,footer:null,onCancel:t,className:"popo-public-editor-preview-modal",destroyOnClose:!0,width:1e3,getContainer:function(){return i==null?void 0:i.getEditorDom()},children:s?(0,S.jsx)("div",{dangerouslySetInnerHTML:{__html:n},className:"rock-editor__renderer"}):(0,S.jsx)(ce,{content:n,useTagList:e,className:"rock-editor__renderer"})})}),Be=We,He=function(c){le()(n,c);var o=ue()(n);function n(t,s){var e,i,a,u,d,v,l;return se()(this,n),l=o.call(this),U()(O()(l),"name","Preview"),U()(O()(l),"uiLocale",{}),U()(O()(l),"useTagList",!1),U()(O()(l),"_popUp",null),U()(O()(l),"customPreview",void 0),U()(O()(l),"ref",void 0),U()(O()(l),"isEnabled",function(){return!0}),U()(O()(l),"waitForUserInput",function(E){return l._popUp?Promise.resolve(void 0):new Promise(function(T){var f;l._popUp=(0,P.wo)(Be,{wrapRef:(f=l.ref)===null||f===void 0?void 0:f.current,isCustomPreview:!!l.customPreview,useTagList:l.useTagList,uiLocale:l.uiLocale,content:l.customPreview?l.customPreview((0,P.cn)(E)):(0,P.cn)(E),onOk:function(R){T(R),l._popUp.destroy(),l._popUp=null},onCancel:function(){T(void 0),l._popUp.destroy(),l._popUp=null}})})}),U()(O()(l),"executeWithUserInput",function(E,T,f,g){return!0}),l.icon=t,l.tooltip=(e=s.tooltip)!==null&&e!==void 0?e:{},l.desc=(i=s.desc)!==null&&i!==void 0?i:{},l.customPreview=(a=s.customPreview)!==null&&a!==void 0?a:null,l.useTagList=(u=s.useTagList)!==null&&u!==void 0?u:!1,l.ref=(d=s.ref)!==null&&d!==void 0?d:null,l.uiLocale=(v=s.uiLocale)!==null&&v!==void 0?v:{},l}return G()(n)}(P.YY),$e=He,_e=function(o){var n=new $e((0,S.jsx)(oe.Z,{}),{tooltip:{"zh-CN":"\u9884\u89C8","en-US":"Preview"},customPreview:o==null?void 0:o.customPreview,useTagList:o==null?void 0:o.useTagList,ref:o==null?void 0:o.ref,uiLocale:o==null?void 0:o.uiLocale});return n},Ze=_e;function Ve(c){var o=c||{},n=o.customPreview,t=o.useTagList,s=o.ref,e=o.uiLocale;return new P.$n({key:new P.H$("preview"),getToolbarConfig:function(a){return a[a.length-1].push(Ze({customPreview:n,useTagList:t,ref:s,uiLocale:e})),a}})}var Ge=Ve,Xe=r(99669),Ye=r(7346);function fe(c,o){for(var n=c.nextSibling;n;){if(n.classList.contains(o))return n;n=n.nextSibling}return null}var Je=function(o){var n,t=o.tagList,s=o.onClick,e=o.isReady,i=o.uiLocale,a=(0,b.useRef)(null),u=function(){var v,l=fe(a.current,"rock-editor");if(l){var E=l.querySelector(".rock-editor__toolbar");if(E){var T=(v=a.current)===null||v===void 0?void 0:v.offsetHeight;if(T){var f=fe(E,"prosemirror-wrapper");f&&(f.style.marginTop="".concat(T,"px"))}}}};return(0,b.useEffect)(function(){return e&&u(),window.addEventListener("resize",u),function(){window.removeEventListener("resize",u)}},[e]),(0,S.jsx)("div",{className:"rock-editor-tag-extra-container",ref:a,children:(0,S.jsxs)(Xe.Z,{wrap:!0,children:[((n=i.TagPlugin)===null||n===void 0?void 0:n.option)||"\u53EF\u9009\u5B57\u6BB5\uFF1A",t==null?void 0:t.map(function(d){var v=d.id,l=d.fieldName;return(0,S.jsx)(Ye.Z,{text:l,size:"small",onClick:function(){return s(d)}},v)})]})})},Qe=Je,Ft=r(73989),zt=r(34668),qe=r(79935),L=r.n(qe),et="https://netease-frontend-institute.github.io",tt="https://ehr-service.netease.com",ve=location.origin===et?tt:location.origin,rt=function(o){var n=o.nosKey,t=o.bucketName,s=o.fileName,e=o.nosUrl;return new Promise(function(i,a){L().ajax({type:"get",url:"".concat(ve).concat(e),data:{nosKey:n,bucketName:t,fileName:encodeURIComponent(s),fileNameEncode:"URL_ENCODE"},success:function(d){return d.code===200?i(d.data):a()},error:a})})},nt=function(o){var n=o.uploader,t=o.param,s=o.nosKey,e=o.bucketName,i=o.nosUrl;return new Promise(function(a,u){n.upload(t,function(d){rt({nosKey:s,bucketName:e,fileName:d.fileName,nosUrl:i}).then(function(v){a(v)}).catch(function(v){u(v)})})})},ot=function(o){var n=o.uploader,t=o.file,s=o.nosKey,e=o.bucketName,i=o.token,a=o.trunkSize,u=o.nosUrl;return new Promise(function(d){n.addFile(t,M()(p()().mark(function v(){var l,E;return p()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return l={bucketName:e,objectName:s,token:i,trunkSize:a},f.next=3,nt({uploader:n,param:l,nosKey:s,bucketName:e,nosUrl:u});case 3:E=f.sent,d(E);case 5:case"end":return f.stop()}},v)})))})},it=function(){var c=M()(p()().mark(function o(n){var t,s,e;return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=n.email,t){a.next=3;break}return a.abrupt("return",Promise.reject("no email"));case 3:return a.next=5,fetch("https://bedrock.netease.com:8010/api/bedrock/getPopoName?email=".concat(t));case 5:return s=a.sent,a.next=8,s.json();case 8:return e=a.sent,a.abrupt("return",e);case 10:case"end":return a.stop()}},o)}));return function(n){return c.apply(this,arguments)}}(),at=function(o){return"https://unpkg.oa.netease.com/@bedrock/static/emoji-big/".concat(o)};function st(c){if(!c)return c;var o=document.createElement("div");o.innerHTML=c;for(var n=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT),t=n.nextNode();t;){var s=t.getAttribute("style");if(s&&!t.hasAttribute("data-indent")){var e=/text-indent:\s*(\d+)em;/i.exec(s);if(e){var i=parseInt(e[1],10)/2;t.setAttribute("data-indent","".concat(i,"em"))}}t=n.nextNode()}return o.innerHTML}var ge={uploadFailed:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",maxLengthError:"\u6587\u4EF6\u540D\u8FC7\u957F\uFF08\u9700\u63A7\u5236\u5728100\u5B57\u7B26\u5185\uFF09",maxSizeError:"\u6587\u4EF6\u8FC7\u5927",PreviewPlugin:{preview:"\u9884\u89C8"},TagPlugin:{option:"\u53EF\u9009\u5B57\u6BB5:"}},lt={uploadFailed:"File upload failed",maxLengthError:"The file name is too long (must be controlled within 100 characters)",maxSizeError:"File too large",PreviewPlugin:{preview:"Preview"},TagPlugin:{option:"Optional fields:"}},kt=r(56154);function ut(c){"use strict";var o={protocol:location.protocol||"https:",urlDns:"http://wanproxy.127.net/lbs",retryCount:2,fileInputID:"fileInput",timeout:5e4,onError:function(e){console.log(e)},onProgress:function(e){console.log(e.status),console.log(e.progress)}},n,t;return n=L().extend({},o,c),t={version:"1.0",uploadFile:null,edgeNodeList:null,dnsRetryCount:0,uTRetryCount:n.retryCount,gORetryCount:n.retryCount,gDRetryCount:n.retryCount,createAjax:function(){var e={};return window.XMLHttpRequest&&(e=new XMLHttpRequest),e},clearStorage:function(e,i,a){localStorage.removeItem(a+"_progress"),localStorage.removeItem(a+"_"+e+"_"+i+"_context")},addFile:function(e,i){if(e){var a=J()(e.name+":"+e.size).toString(),u;u={fileKey:a,file:e,fileName:e.name,status:0,progress:localStorage.getItem(a+"_progress")||0},t.uploadFile&&(t.uploadFile=null),t.uploadFile=L().extend(!0,{},u),i&&i(u)}},getFile:function(e){var i;return t.uploadFile.fileKey===e&&(i=t.uploadFile),i},getDNS:function(e,i){if((e==null||e==="")&&(e=""),t.edgeNodeList)i(t.edgeNodeList);else if(n.protocol==="https:"){var a=["https://wanproxy-web.127.net"];t.edgeNodeList=a,i(a,n.urlDns)}else L().ajax({type:"get",url:n.urlDns,data:{version:t.version,bucketname:e},dataType:"json",success:function(d){d.code?n.onError({errCode:d.Code,errMsg:d.Message}):(t.edgeNodeList=d.upload,i(d.upload,d.lbs))},error:function(d){d.status.toString().match(/^5/)&&t.gDRetryCount>0&&t.gDRetryCount<n.retryCount+1?(t.getDNS(e,i),t.gDRetryCount--):(n.onError(d.responseText),t.gDRetryCount=n.retryCount)}})},getOffset:function(e,i){var a;if(a=localStorage.getItem(e.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),!a)return i(0);L().ajax({type:"get",url:e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+"?uploadContext",data:{version:t.version,context:a},dataType:"json",beforeSend:function(d){d.setRequestHeader("x-nos-token",e.token)},success:function(d){d.errCode?n.onError({errCode:d.errCode,errMsg:d.errMsg}):i(d.offset)},error:function(d){d.status.toString().match(/^5/)&&t.gORetryCount>0&&t.gORetryCount<n.retryCount+1?(t.getOffset(e,i),t.gORetryCount--):(n.onError(d.responseText),t.gORetryCount=n.retryCount,d.status===404&&t.clearStorage(e.bucketName,e.objectName,e.fileKey))}})},uploadTrunk:function(e,i,a){var u,d="",v,l,E=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(v=t.getFile(i.fileKey),l=localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),v.xhr?u=v.xhr:(u=t.createAjax(),v.xhr=u),u.upload.onprogress=function(f){var g=0;f.lengthComputable?(g=(i.offset+f.loaded)/i.file.size,v.progress=(g*100).toFixed(2),g>0&&g<1?(v.status=1,L()("#"+n.fileInputID).attr("disabled",!0)):g===1&&(v.status=2,L()("#"+n.fileInputID).attr("disabled",!1)),localStorage.setItem(i.fileKey+"_progress",v.progress),n.onProgress(v)):(console.log("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6",f),n.onError({errMsg:"\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6"}))},u.onreadystatechange=function(){if(u.readyState===4){var f;try{f=JSON.parse(u.responseText)}catch(R){f={errMsg:"\u672A\u77E5\u9519\u8BEF"}}if(u.status===200)v.file.size===0&&(v.status=2,v.progress=100,n.onProgress(v)),localStorage.setItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context",f.context),f.offset<i.file.size?t.uploadTrunk(e,L().extend({},i,{offset:f.offset,trunkEnd:f.offset+i.trunkSize,context:l||f.context}),a):a(i);else if(u.status.toString().match(/^5/))if(t.uTRetryCount<n.retryCount+1&&t.uTRetryCount>0)t.getOffset({serveIp:e.serveIp,bucketName:e.bucketName,objectName:e.objectName,token:e.token,fileKey:i.fileKey},function(R){t.uploadTrunk(e,L().extend({},i,{offset:R,trunkEnd:R+i.trunkSize,context:localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)}),t.uTRetryCount--;else if(t.dnsRetryCount<t.edgeNodeList.length-1){t.uTRetryCount=n.retryCount,t.dnsRetryCount++;var g=L().extend({},e,{serveIp:t.edgeNodeList[t.dnsRetryCount]});t.getOffset({serveIp:g.serveIp,bucketName:g.bucketName,objectName:g.objectName,token:g.token,fileKey:i.fileKey},function(R){t.uploadTrunk(g,L().extend({},i,{offset:R,trunkEnd:R+i.trunkSize,context:localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)})}else t.dnsRetryCount=0,n.onError({errCode:f.errCode,errMsg:f.errMsg}),L()("#"+n.fileInputID).attr("disabled",!1),t.clearStorage(e.bucketName,e.objectName,i.fileKey);else L()("#"+n.fileInputID).attr("disabled",!1),u.status&&(t.clearStorage(e.bucketName,e.objectName,i.fileKey),n.onError({errCode:f.errCode,errMsg:f.errMsg}))}},d="?offset="+i.offset+"&complete="+(i.trunkEnd>=i.file.size)+"&context="+(l||i.context)+"&version="+t.version,u.open("post",e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+d),u.timeout=n.timeout,u.setRequestHeader("x-nos-token",e.token),navigator.userAgent.indexOf("WindowsWechat")>=0){var T=new FileReader;T.addEventListener("loadend",function(){var f=new Blob([T.result]);u.send(f)}),T.readAsArrayBuffer(E.call(i.file,i.offset,i.trunkEnd))}else u.send(E.call(i.file,i.offset,i.trunkEnd))},pauseUpload:function(){var e;t.uploadFile?t.uploadFile.xhr?t.uploadFile.status<2&&(e=t.uploadFile.xhr,e.abort(),L()("#"+n.fileInputID).attr("disabled",!1)):n.onError({errMsg:"\u5F53\u524D\u6587\u4EF6\u672A\u5F00\u59CB\u4E0A\u4F20"}):n.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"})},upload:function(e,i){if(!e.bucketName&&e.bucketName!==0){n.onError({errMsg:"\u6876\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.objectName&&e.objectName!==0){n.onError({errMsg:"\u5BF9\u8C61\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.token){n.onError({errMsg:"\u4E0A\u4F20\u51ED\u8BC1\u4E0D\u80FD\u4E3A\u7A7A"});return}if(e.trunkSize?Object.prototype.toString.call(e.trunkSize)==="[object String]"&&(e.trunkSize=parseInt(e.trunkSize)):e.trunkSize=128*1024,!t.uploadFile){n.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"});return}var a=t.uploadFile;t.getDNS(e.bucketName,function(u){if(u.length===0){n.onError({errMsg:"\u6682\u65E0\u8FB9\u7F18\u8282\u70B9"});return}t.getOffset({serveIp:u[0],bucketName:e.bucketName,objectName:e.objectName,fileKey:a.fileKey,token:e.token},function(d){t.uploadTrunk({serveIp:u[0],bucketName:e.bucketName,objectName:e.objectName,token:e.token},{file:a.file,fileKey:a.fileKey,offset:d||0,trunkSize:e.trunkSize,trunkEnd:(d||0)+e.trunkSize,context:""},function(v){t.clearStorage(e.bucketName,e.objectName,v.fileKey),i&&i(a)})})})}},t}var dt=ut,ct=["config","initialHtml","tagList","onChange","uploadProps","previewProps","onReady","locale"],ft=["features","getPlugins"],vt=500*1024*1024,gt=4*1024*1024;function mt(c,o){var n=c.config,t=c.initialHtml,s=c.tagList,e=c.onChange,i=c.uploadProps,a=c.previewProps,u=c.onReady,d=c.locale,v=d===void 0?"zh":d,l=Z()(c,ct),E={zh:"zh-CN",en:"en-US"},T={zh:ge,en:lt},f=T[v]||ge,g=i||{},R=g.maxSize,pt=R===void 0?vt:R,pe=g.beforeUpload,Ee=g.nosTokenUrl,Et=Ee===void 0?"/api/file/nos/token":Ee,Pe=g.bucketName,ye=Pe===void 0?"rms":Pe,he=g.trunkSize,Pt=he===void 0?gt:he,Ce=g.nosUrl,yt=Ce===void 0?"/api/file/nos/url":Ce,ie=n||{},ht=ie.features,Ne=ie.getPlugins,Ct=Z()(ie,ft),Nt=a||{},St=Nt.customPreview,Tt=(0,b.useState)(!1),Se=K()(Tt,2),xt=Se[0],Lt=Se[1],Rt=(0,b.useState)(),Te=K()(Rt,2),Mt=Te[0],bt=Te[1],A=(0,b.useRef)(null);(0,b.useImperativeHandle)(o,function(){return{editorRef:A.current,convertToHTML:P.cn}});var It=function(){var k=M()(p()().mark(function N(j,F){var w,W,z,Q,Y,B,q,H,ee,te,xe;return p()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(w=F.onProgress,j){I.next=3;break}return I.abrupt("return",Promise.reject(f.uploadFailed));case 3:return W=0,z=setInterval(function(){W+=1,w(W),W>=90&&clearInterval(z)},100),Q=j.size,Y=j.name,B=J()(Y+":"+Q+":"+new Date().getTime()).toString(),I.next=9,fetch("".concat(ve).concat(Et,"?nosKey=").concat(B,"&bucketName=").concat(ye));case 9:return q=I.sent,I.next=12,q.json();case 12:return H=I.sent,ee=H.data,te=dt({onError:function(){V.Z.error(f.uploadFailed)}}),I.next=17,ot({uploader:te,file:j,nosKey:B,bucketName:ye,token:ee,nosUrl:yt,trunkSize:Pt});case 17:return xe=I.sent,I.abrupt("return",{src:xe});case 19:case"end":return I.stop()}},N)}));return function(j,F){return k.apply(this,arguments)}}(),jt=function(N){return N.name.length>100?(V.Z.error(f.maxLengthError),!1):N.size>pt?(V.Z.error(f.maxSizeError),!1):pe?pe(N):!0},Ot=y()(y()({features:y()({invertWhenPasteSimilarColor:{enable:!0,threshold:.1},fontSize:!0,image:{singleButton:!0,allowEdit:!0},fullScreen:!0},ht||{}),beforeImageUpload:jt,uploadImage:It},Ct),{},{locale:E[v],getPlugins:function(){var N=[(0,P._C)({getPopoName:it}),(0,P.YV)(),(0,P.SN)(),Ge({customPreview:St,ref:A,useTagList:!!(s!=null&&s.length),uiLocale:f}),(0,P._8)(),(0,P.hF)({insertAfter:"IndentDropdown"}),(0,P.zF)({covertNameToSrc:at,insertAfter:"TextBgPicker"})];return s&&N.push(de()),Ne?Ne(N):N}}),Ut=function(N){var j,F,w,W=(j=A.current)===null||j===void 0?void 0:j.getEditorState(),z=A==null||(F=A.current)===null||F===void 0||(w=F.getEditorView)===null||w===void 0?void 0:w.call(F),Q=z||{},Y=Q.dispatch;if(Y){var B=W||{},q=B.schema,H=B.tr,ee=q.nodes.tag,te=ee.create({name:N.fieldName},null,void 0);H=H.replaceSelectionWith(te),Y(H)}z==null||z.focus()},Dt=function(N){Lt(!0),u==null||u(N)},Kt=function(N,j){bt(N),e==null||e(N,j)};return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{className:"bedrock-editor-wrapper",children:[!!s&&(0,S.jsx)(Qe,{tagList:s,onClick:Ut,isReady:xt,uiLocale:f}),(0,S.jsx)(P.ZP,y()(y()({autoFocus:!0},l),{},{editorState:Mt,onChange:Kt,ref:A,style:y()({"--r-editor-content-font-size":"14px","--r-editor-content-min-height":"240px","--r-editor-content-color":"#333","--text-color-1":"#333","--primary-1":"#1890ff","--br60":"#1890ff"},(l==null?void 0:l.style)||{}),config:Ot,onReady:Dt,initialHtml:st(t)}))]})})}var me=(0,b.forwardRef)(mt),wt=r(49290),Wt=function(o,n){var t=o.className,s=o.style,e=o.content,i=o.beforeRenderContent,a=o.useZmage,u=a===void 0?!0:a,d=o.usePopoLink,v=d===void 0?!0:d,l=useRef(null);useImperativeHandle(n,function(){return{element:l.current}});var E=i?i(e):e,T=function(g){g.persist(),u&&g.target.localName==="img"&&Zmage.browsing({src:g.target.currentSrc,backdrop:"rgba(0, 0, 0, 0.5)"})};return useEffect(function(){if(l.current&&v){var f=l.current.querySelectorAll(".popo-link-node");f.forEach(function(g){var R=g.getAttribute("data-email");R&&g.addEventListener("click",function(){window.open("http://popo.netease.com/static/html/open_popo.html?ssid=".concat(R,"&sstp=0"))})})}},[E,v]),_jsx("div",{ref:l,className:"rock-editor__renderer ".concat(t),style:_objectSpread(_objectSpread({},s||{}),{},{"--text-color-1":"#333"}),onClick:T,dangerouslySetInnerHTML:{__html:E}})},Bt=null},86010:function(){}}]);
