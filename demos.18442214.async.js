(self.webpackChunk_ehr_ui_bedrock_editor=self.webpackChunk_ehr_ui_bedrock_editor||[]).push([[433],{79292:function(D,m,t){"use strict";t.r(m);var C=t(89379),h=t(93236),y=t(62086);m.default=function(){return(0,y.jsx)(C.ML,{})}},19847:function(D,m,t){"use strict";t.r(m);var C=t(89379),h=t(93236),y=t(62086),E='<p><span style="font-size:16px"><strong>\u5DE5\u5177\u5F00\u53D1\uFF1A</strong></span></p><p>V0.0.2\u7248\u672C\u4EA4\u4E92\u7A3F\u786E\u8BA4\uFF0C\u672C\u5468\u542F\u52A8\u4EA4\u4E92\u8BC4\u5BA1</p><p></p><p><span style="font-size:16px"><strong>\u914D\u97F3\u5DE5\u5177\u4E1A\u52A1\u589E\u957F\uFF1A</strong></span></p><p style="text-indent:2em;">\u5916\u90E8\u6E38\u620F\u5BA2\u6237\u5DF2\u62A5\u4EF7\uFF0C\u5DE5\u5177</p><p style="text-indent:2em;">\u4E60\u8FD1\u5E73\u603B\u4E66\u8BB0\u80AF\u5B9A\u4E86\u201C\u4E00\u5E26\u4E00\u8DEF</p><p style="text-indent:2em;">\u5B9E\u73B0\u4E86\u540C\u5171\u5EFA\u56FD\u5BB6\u4E92\u5229\u5171\u8D62</p><p style="text-indent:2em;"><span style="font-size:14px">\u5171\u5EFA\u2018\u4E00\u5E26\u4E00\u8DEF\u2019\uFF0C\u63D0\u9AD8\u4E86\u56FD\u5185\u5404\u533A\u57DF\u5F00\u653E\u6C34\u5E73\uFF0C\u62D3\u5C55\u4E86\u5BF9\u5916\u5F00\u653E\u9886\u57DF\uFF0C\u63A8\u52A8\u4E86\u5236\u5EA6\u578B\u5F00</span><br/></p>';m.default=function(){return(0,y.jsx)(C.ML,{initialHtml:E})}},29341:function(D,m,t){"use strict";t.r(m);var C=t(54306),h=t.n(C),y=t(93236),E=t(89379),T=t(43665),R=t(62086),j=T.Z.TabPane;m.default=function(){var z=(0,y.useRef)(null),w=(0,y.useState)(""),F=h()(w,2),L=F[0],p=F[1],W=function(_){p(_)};return(0,R.jsxs)(T.Z,{type:"card",destroyInactiveTabPane:!0,children:[(0,R.jsx)(j,{tab:"\u7F16\u8F91\u6A21\u5F0F",children:(0,R.jsx)(E.ML,{ref:z,onChange:W})},1),(0,R.jsx)(j,{tab:"\u5C55\u793A\u6A21\u5F0F",children:(0,R.jsx)(E.Pq,{content:L})},2)]})}},89764:function(D,m,t){"use strict";t.r(m);var C=t(54306),h=t.n(C),y=t(89379),E=t(93236),T=t(14253),R=t(83416),j=t(62086);m.default=function(){var z=T.ZP.useForm(),w=h()(z,1),F=w[0],L=(0,E.useRef)();(0,E.useEffect)(function(){var B,_=(B=L.current)===null||B===void 0?void 0:B.convertFromHtml("<blockquote><p>werwerwet</p></blockquote><p>wqewqwe</p>");console.log("state",_),F.setFieldsValue({editor:_})},[]);var p=function(_){console.log(_)},W=function(_){console.log("onFinish",_)};return(0,j.jsxs)(T.ZP,{form:F,onValuesChange:p,onFinish:W,layout:"vertical",children:[(0,j.jsx)(T.ZP.Item,{label:"\u5BCC\u6587\u672C",name:"editor",children:(0,j.jsx)(y.ML,{ref:L})}),(0,j.jsx)(R.Z,{onClick:F.submit,children:"\u63D0\u4EA4"})]})}},48399:function(D,m,t){"use strict";t.r(m);var C=t(89379),h=t(93236),y=t(62086);m.default=function(){var E=[{id:1,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:2,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:3,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:4,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:5,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:6,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:7,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:8,fieldName:"\u5E94\u8058\u90E8\u95E8"}];return(0,y.jsx)(C.ML,{locale:"en",tagList:E})}},74073:function(D,m,t){"use strict";t.r(m);var C=t(89379),h=t(93236),y=t(62086);m.default=function(){return(0,y.jsx)(C.ML,{config:{getPlugins:function(T){return console.log("plugins",T),T.splice(5,1),T.push((0,C.Hn)()),T}}})}},92627:function(D,m,t){"use strict";t.r(m);var C=t(93236),h=t(89379),y=t(62086),E=function(R){return`<div style="width: 750px; margin: 0 auto;">
<div style="min-height: 128px; background-image: url(https://nos.netease.com/rms/7cf241cf1fb0b61f07d29dca9dce75cf); background-repeat: no-repeat; background-size: cover;">
<div style="padding: 70px 55px 0; overflow: hidden; font-size: 24px; color: #FFF; text-overflow: ellipsis; word-wrap: normal; white-space: nowrap; ">
<strong>\u90AE\u4EF6\u6807\u9898</strong>
</div></div><div style="padding: 20px 55px; background-color: #A00405;"><div style="padding: 30px; background-color: #FFF; border-radius: 10px;">`.concat(R,'</div></div><div style="height: 95px; background-image: url(https://nos.netease.com/rms/b2a0bcacab15a20508de56e0d69eedc4); background-repeat: no-repeat; background-size: cover;"></div></div>')};m.default=function(){return(0,y.jsx)(h.ML,{previewProps:{customPreview:E}})}},52380:function(D,m,t){"use strict";t.r(m);var C=t(93236),h=t(83416),y=t(89379),E=t(62086);m.default=function(){var T=(0,C.useRef)(null),R=function(){var z=T.current.editorRef,w=T.current.convertToHTML(z.getEditorState());console.log("htmlStr",w)};return(0,E.jsxs)("div",{children:[(0,E.jsx)(y.ML,{ref:T}),(0,E.jsx)(h.Z,{onClick:R,children:"\u63D0\u4EA4"})]})}},6211:function(D,m,t){"use strict";t.r(m);var C=t(89379),h=t(93236),y=t(62086),E=[{id:1,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:2,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:3,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:4,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:5,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:6,fieldName:"\u5E94\u8058\u90E8\u95E8"},{id:7,fieldName:"\u5E94\u8058\u804C\u4F4D"},{id:8,fieldName:"\u5E94\u8058\u90E8\u95E8"}];m.default=function(){return(0,y.jsx)(C.ML,{tagList:E})}},89379:function(D,m,t){"use strict";t.d(m,{ML:function(){return fe},Pq:function(){return le},Hn:function(){return p.Hn}});var C=t(57213),h=t.n(C),y=t(25359),E=t.n(y),T=t(49811),R=t.n(T),j=t(54306),z=t.n(j),w=t(12342),F=t.n(w),L=t(93236),p=t(31292),W=t(93782),B=t(50958),_=t(47899),re=t.n(_),Te=t(93614),Le=t(63466),ne=t.n(Le),Me=t(21140),oe=t.n(Me),Re=t(68608),A=t.n(Re),xe=t(58853),ie=t.n(xe),Se=t(38888),ae=t.n(Se),be=t(52510),K=t.n(be),Ie=t(996),Ft=t(87351),Oe=t(78017),je=t.n(Oe),_e=t(44908),Ue=t.n(_e),M=t(62086),De=function(o){var n=o.node,r=n.attrs,s=r.name;return(0,M.jsx)("span",{className:"keyword-item",children:s})};function Fe(){return function(c){ie()(n,c);var o=ae()(n);function n(r,s,e,i){return oe()(this,n),o.call(this,r,s,e,i)}return ne()(n,[{key:"createDOMElement",value:function(){var s=document.createElement("span");return s}},{key:"update",value:function(s,e){var i=je()(Ue()(n.prototype),"update",this).call(this,s,e);return i&&!0}},{key:"renderReactComponent",value:function(){return(0,M.jsx)(De,h()({},this.props))}}]),n}(p.rr)}var Ae=Fe,Ke={attrs:{name:{default:""}},inline:!0,group:"inline",draggable:!0,toDOM:function(o){var n=o.attrs.name;return["span",{class:"keyword-item"},"".concat(n)]},parseDOM:[{tag:"span.keyword-item",getAttrs:function(o){var n=o.textContent;return{name:n}}}]};function ze(){return new p.$n({key:new p.H$("tag"),nodeSpecs:{tag:Ke},nodeViews:{tag:Ae()}})}var se=ze,ke=function(o,n){var r=o.className,s=o.style,e=o.content,i=o.beforeRenderContent,a=o.useTagList,u=(0,L.useRef)(null);(0,L.useImperativeHandle)(n,function(){return{element:u.current}});var d=i?i(e):e,v=function(P){return a&&P.push(se()),P};return(0,M.jsx)("div",{className:r,children:(0,M.jsx)(fe,{initialHtml:d,readOnly:!0,isHideToolbar:!0,config:{getPlugins:v},style:s||{}})})},le=(0,L.forwardRef)(ke),we=L.forwardRef(function(c){var o,n=c.content,r=c.onCancel,s=c.isCustomPreview,e=c.useTagList,i=c.wrapRef,a=c.uiLocale,u=a===void 0?{}:a;return(0,M.jsx)(Ie.Z,{title:((o=u.PreviewPlugin)===null||o===void 0?void 0:o.preview)||"\u9884\u89C8",visible:!0,scrolled:!0,footer:null,onCancel:r,className:"popo-public-editor-preview-modal",destroyOnClose:!0,width:1e3,getContainer:function(){return i==null?void 0:i.getEditorDom()},children:s?(0,M.jsx)("div",{dangerouslySetInnerHTML:{__html:n},className:"rock-editor__renderer"}):(0,M.jsx)(le,{content:n,useTagList:e,className:"rock-editor__renderer"})})}),We=we,Be=function(c){ie()(n,c);var o=ae()(n);function n(r,s){var e,i,a,u,d,v,l;return oe()(this,n),l=o.call(this),K()(A()(l),"name","Preview"),K()(A()(l),"uiLocale",{}),K()(A()(l),"useTagList",!1),K()(A()(l),"_popUp",null),K()(A()(l),"customPreview",void 0),K()(A()(l),"ref",void 0),K()(A()(l),"isEnabled",function(){return!0}),K()(A()(l),"waitForUserInput",function(P){return l._popUp?Promise.resolve(void 0):new Promise(function(x){var f;l._popUp=(0,p.wo)(We,{wrapRef:(f=l.ref)===null||f===void 0?void 0:f.current,isCustomPreview:!!l.customPreview,useTagList:l.useTagList,uiLocale:l.uiLocale,content:l.customPreview?l.customPreview((0,p.cn)(P)):(0,p.cn)(P),onOk:function(b){x(b),l._popUp.destroy(),l._popUp=null},onCancel:function(){x(void 0),l._popUp.destroy(),l._popUp=null}})})}),K()(A()(l),"executeWithUserInput",function(P,x,f,g){return!0}),l.icon=r,l.tooltip=(e=s.tooltip)!==null&&e!==void 0?e:{},l.desc=(i=s.desc)!==null&&i!==void 0?i:{},l.customPreview=(a=s.customPreview)!==null&&a!==void 0?a:null,l.useTagList=(u=s.useTagList)!==null&&u!==void 0?u:!1,l.ref=(d=s.ref)!==null&&d!==void 0?d:null,l.uiLocale=(v=s.uiLocale)!==null&&v!==void 0?v:{},l}return ne()(n)}(p.YY),He=Be,$e=function(o){var n=new He((0,M.jsx)(Te.Z,{}),{tooltip:{"zh-CN":"\u9884\u89C8","en-US":"Preview"},customPreview:o==null?void 0:o.customPreview,useTagList:o==null?void 0:o.useTagList,ref:o==null?void 0:o.ref,uiLocale:o==null?void 0:o.uiLocale});return n},Ze=$e;function Ve(c){var o=c||{},n=o.customPreview,r=o.useTagList,s=o.ref,e=o.uiLocale;return new p.$n({key:new p.H$("preview"),getToolbarConfig:function(a){return a[a.length-1].push(Ze({customPreview:n,useTagList:r,ref:s,uiLocale:e})),a}})}var Ge=Ve,Xe=t(99669),Ye=t(7346);function ue(c,o){for(var n=c.nextSibling;n;){if(n.classList.contains(o))return n;n=n.nextSibling}return null}var Je=function(o){var n,r=o.tagList,s=o.onClick,e=o.isReady,i=o.uiLocale,a=(0,L.useRef)(null),u=function(){var v,l=ue(a.current,"rock-editor");if(l){var P=l.querySelector(".rock-editor__toolbar");if(P){var x=(v=a.current)===null||v===void 0?void 0:v.offsetHeight;if(x){var f=ue(P,"prosemirror-wrapper");f&&(f.style.marginTop="".concat(x,"px"))}}}};return(0,L.useEffect)(function(){return e&&u(),window.addEventListener("resize",u),function(){window.removeEventListener("resize",u)}},[e]),(0,M.jsx)("div",{className:"rock-editor-tag-extra-container",ref:a,children:(0,M.jsxs)(Xe.Z,{wrap:!0,children:[((n=i.TagPlugin)===null||n===void 0?void 0:n.option)||"\u53EF\u9009\u5B57\u6BB5\uFF1A",r==null?void 0:r.map(function(d){var v=d.id,l=d.fieldName;return(0,M.jsx)(Ye.Z,{text:l,size:"small",onClick:function(){return s(d)}},v)})]})})},Qe=Je,At=t(73989),Kt=t(34668),qe=t(79935),S=t.n(qe),et="https://netease-frontend-institute.github.io",tt="https://ehr-service.netease.com",de=location.origin===et?tt:location.origin,rt=function(o){var n=o.nosKey,r=o.bucketName,s=o.fileName,e=o.nosUrl;return new Promise(function(i,a){S().ajax({type:"get",url:"".concat(de).concat(e),data:{nosKey:n,bucketName:r,fileName:encodeURIComponent(s),fileNameEncode:"URL_ENCODE"},success:function(d){return d.code===200?i(d.data):a()},error:a})})},nt=function(o){var n=o.uploader,r=o.param,s=o.nosKey,e=o.bucketName,i=o.nosUrl;return new Promise(function(a,u){n.upload(r,function(d){rt({nosKey:s,bucketName:e,fileName:d.fileName,nosUrl:i}).then(function(v){a(v)}).catch(function(v){u(v)})})})},ot=function(o){var n=o.uploader,r=o.file,s=o.nosKey,e=o.bucketName,i=o.token,a=o.trunkSize,u=o.nosUrl;return new Promise(function(d){n.addFile(r,R()(E()().mark(function v(){var l,P;return E()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return l={bucketName:e,objectName:s,token:i,trunkSize:a},f.next=3,nt({uploader:n,param:l,nosKey:s,bucketName:e,nosUrl:u});case 3:P=f.sent,d(P);case 5:case"end":return f.stop()}},v)})))})},it=function(){var c=R()(E()().mark(function o(n){var r,s,e;return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=n.email,r){a.next=3;break}return a.abrupt("return",Promise.reject("no email"));case 3:return a.next=5,fetch("https://bedrock.netease.com:8010/api/bedrock/getPopoName?email=".concat(r));case 5:return s=a.sent,a.next=8,s.json();case 8:return e=a.sent,a.abrupt("return",e);case 10:case"end":return a.stop()}},o)}));return function(n){return c.apply(this,arguments)}}(),at=function(o){return"https://unpkg.oa.netease.com/@bedrock/static/emoji-big/".concat(o)};function st(c){if(!c)return c;var o=document.createElement("div");o.innerHTML=c;for(var n=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT),r=n.nextNode();r;){var s=r.getAttribute("style");if(s&&!r.hasAttribute("data-indent")){var e=/text-indent:\s*(\d+)em;/i.exec(s);if(e){var i=parseInt(e[1],10)/2;r.setAttribute("data-indent","".concat(i,"em"))}}r=n.nextNode()}return o.innerHTML}var ce={uploadFailed:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",maxLengthError:"\u6587\u4EF6\u540D\u8FC7\u957F\uFF08\u9700\u63A7\u5236\u5728100\u5B57\u7B26\u5185\uFF09",maxSizeError:"\u6587\u4EF6\u8FC7\u5927",PreviewPlugin:{preview:"\u9884\u89C8"},TagPlugin:{option:"\u53EF\u9009\u5B57\u6BB5:"}},lt={uploadFailed:"File upload failed",maxLengthError:"The file name is too long (must be controlled within 100 characters)",maxSizeError:"File too large",PreviewPlugin:{preview:"Preview"},TagPlugin:{option:"Optional fields:"}},zt=t(56154);function ut(c){"use strict";var o={protocol:location.protocol||"https:",urlDns:"http://wanproxy.127.net/lbs",retryCount:2,fileInputID:"fileInput",timeout:5e4,onError:function(e){console.log(e)},onProgress:function(e){console.log(e.status),console.log(e.progress)}},n,r;return n=S().extend({},o,c),r={version:"1.0",uploadFile:null,edgeNodeList:null,dnsRetryCount:0,uTRetryCount:n.retryCount,gORetryCount:n.retryCount,gDRetryCount:n.retryCount,createAjax:function(){var e={};return window.XMLHttpRequest&&(e=new XMLHttpRequest),e},clearStorage:function(e,i,a){localStorage.removeItem(a+"_progress"),localStorage.removeItem(a+"_"+e+"_"+i+"_context")},addFile:function(e,i){if(e){var a=re()(e.name+":"+e.size).toString(),u;u={fileKey:a,file:e,fileName:e.name,status:0,progress:localStorage.getItem(a+"_progress")||0},r.uploadFile&&(r.uploadFile=null),r.uploadFile=S().extend(!0,{},u),i&&i(u)}},getFile:function(e){var i;return r.uploadFile.fileKey===e&&(i=r.uploadFile),i},getDNS:function(e,i){if((e==null||e==="")&&(e=""),r.edgeNodeList)i(r.edgeNodeList);else if(n.protocol==="https:"){var a=["https://wanproxy-web.127.net"];r.edgeNodeList=a,i(a,n.urlDns)}else S().ajax({type:"get",url:n.urlDns,data:{version:r.version,bucketname:e},dataType:"json",success:function(d){d.code?n.onError({errCode:d.Code,errMsg:d.Message}):(r.edgeNodeList=d.upload,i(d.upload,d.lbs))},error:function(d){d.status.toString().match(/^5/)&&r.gDRetryCount>0&&r.gDRetryCount<n.retryCount+1?(r.getDNS(e,i),r.gDRetryCount--):(n.onError(d.responseText),r.gDRetryCount=n.retryCount)}})},getOffset:function(e,i){var a;if(a=localStorage.getItem(e.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),!a)return i(0);S().ajax({type:"get",url:e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+"?uploadContext",data:{version:r.version,context:a},dataType:"json",beforeSend:function(d){d.setRequestHeader("x-nos-token",e.token)},success:function(d){d.errCode?n.onError({errCode:d.errCode,errMsg:d.errMsg}):i(d.offset)},error:function(d){d.status.toString().match(/^5/)&&r.gORetryCount>0&&r.gORetryCount<n.retryCount+1?(r.getOffset(e,i),r.gORetryCount--):(n.onError(d.responseText),r.gORetryCount=n.retryCount,d.status===404&&r.clearStorage(e.bucketName,e.objectName,e.fileKey))}})},uploadTrunk:function(e,i,a){var u,d="",v,l,P=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(v=r.getFile(i.fileKey),l=localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context"),v.xhr?u=v.xhr:(u=r.createAjax(),v.xhr=u),u.upload.onprogress=function(f){var g=0;f.lengthComputable?(g=(i.offset+f.loaded)/i.file.size,v.progress=(g*100).toFixed(2),g>0&&g<1?(v.status=1,S()("#"+n.fileInputID).attr("disabled",!0)):g===1&&(v.status=2,S()("#"+n.fileInputID).attr("disabled",!1)),localStorage.setItem(i.fileKey+"_progress",v.progress),n.onProgress(v)):(console.log("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6",f),n.onError({errMsg:"\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8FDB\u5EA6\u4E8B\u4EF6"}))},u.onreadystatechange=function(){if(u.readyState===4){var f;try{f=JSON.parse(u.responseText)}catch(b){f={errMsg:"\u672A\u77E5\u9519\u8BEF"}}if(u.status===200)v.file.size===0&&(v.status=2,v.progress=100,n.onProgress(v)),localStorage.setItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context",f.context),f.offset<i.file.size?r.uploadTrunk(e,S().extend({},i,{offset:f.offset,trunkEnd:f.offset+i.trunkSize,context:l||f.context}),a):a(i);else if(u.status.toString().match(/^5/))if(r.uTRetryCount<n.retryCount+1&&r.uTRetryCount>0)r.getOffset({serveIp:e.serveIp,bucketName:e.bucketName,objectName:e.objectName,token:e.token,fileKey:i.fileKey},function(b){r.uploadTrunk(e,S().extend({},i,{offset:b,trunkEnd:b+i.trunkSize,context:localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)}),r.uTRetryCount--;else if(r.dnsRetryCount<r.edgeNodeList.length-1){r.uTRetryCount=n.retryCount,r.dnsRetryCount++;var g=S().extend({},e,{serveIp:r.edgeNodeList[r.dnsRetryCount]});r.getOffset({serveIp:g.serveIp,bucketName:g.bucketName,objectName:g.objectName,token:g.token,fileKey:i.fileKey},function(b){r.uploadTrunk(g,S().extend({},i,{offset:b,trunkEnd:b+i.trunkSize,context:localStorage.getItem(i.fileKey+"_"+e.bucketName+"_"+e.objectName+"_context")||""}),a)})}else r.dnsRetryCount=0,n.onError({errCode:f.errCode,errMsg:f.errMsg}),S()("#"+n.fileInputID).attr("disabled",!1),r.clearStorage(e.bucketName,e.objectName,i.fileKey);else S()("#"+n.fileInputID).attr("disabled",!1),u.status&&(r.clearStorage(e.bucketName,e.objectName,i.fileKey),n.onError({errCode:f.errCode,errMsg:f.errMsg}))}},d="?offset="+i.offset+"&complete="+(i.trunkEnd>=i.file.size)+"&context="+(l||i.context)+"&version="+r.version,u.open("post",e.serveIp+"/"+e.bucketName+"/"+encodeURIComponent(e.objectName)+d),u.timeout=n.timeout,u.setRequestHeader("x-nos-token",e.token),navigator.userAgent.indexOf("WindowsWechat")>=0){var x=new FileReader;x.addEventListener("loadend",function(){var f=new Blob([x.result]);u.send(f)}),x.readAsArrayBuffer(P.call(i.file,i.offset,i.trunkEnd))}else u.send(P.call(i.file,i.offset,i.trunkEnd))},pauseUpload:function(){var e;r.uploadFile?r.uploadFile.xhr?r.uploadFile.status<2&&(e=r.uploadFile.xhr,e.abort(),S()("#"+n.fileInputID).attr("disabled",!1)):n.onError({errMsg:"\u5F53\u524D\u6587\u4EF6\u672A\u5F00\u59CB\u4E0A\u4F20"}):n.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"})},upload:function(e,i){if(!e.bucketName&&e.bucketName!==0){n.onError({errMsg:"\u6876\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.objectName&&e.objectName!==0){n.onError({errMsg:"\u5BF9\u8C61\u540D\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!e.token){n.onError({errMsg:"\u4E0A\u4F20\u51ED\u8BC1\u4E0D\u80FD\u4E3A\u7A7A"});return}if(e.trunkSize?Object.prototype.toString.call(e.trunkSize)==="[object String]"&&(e.trunkSize=parseInt(e.trunkSize)):e.trunkSize=128*1024,!r.uploadFile){n.onError({errMsg:"\u672A\u9009\u62E9\u9700\u4E0A\u4F20\u7684\u6587\u4EF6"});return}var a=r.uploadFile;r.getDNS(e.bucketName,function(u){if(u.length===0){n.onError({errMsg:"\u6682\u65E0\u8FB9\u7F18\u8282\u70B9"});return}r.getOffset({serveIp:u[0],bucketName:e.bucketName,objectName:e.objectName,fileKey:a.fileKey,token:e.token},function(d){r.uploadTrunk({serveIp:u[0],bucketName:e.bucketName,objectName:e.objectName,token:e.token},{file:a.file,fileKey:a.fileKey,offset:d||0,trunkSize:e.trunkSize,trunkEnd:(d||0)+e.trunkSize,context:""},function(v){r.clearStorage(e.bucketName,e.objectName,v.fileKey),i&&i(a)})})})}},r}var dt=ut,ct=["config","initialHtml","tagList","onChange","uploadProps","previewProps","onReady","locale"],ft=["features","getPlugins"],vt=500*1024*1024,gt=4*1024*1024;function mt(c,o){var n=c.config,r=c.initialHtml,s=c.tagList,e=c.onChange,i=c.uploadProps,a=c.previewProps,u=c.onReady,d=c.locale,v=d===void 0?"zh":d,l=F()(c,ct),P={zh:"zh-CN",en:"en-US"},x={zh:ce,en:lt},f=x[v]||ce,g=i||{},b=g.maxSize,Et=b===void 0?vt:b,ve=g.beforeUpload,ge=g.nosTokenUrl,pt=ge===void 0?"/api/file/nos/token":ge,me=g.bucketName,Ee=me===void 0?"rms":me,pe=g.trunkSize,Pt=pe===void 0?gt:pe,Pe=g.nosUrl,ht=Pe===void 0?"/api/file/nos/url":Pe,te=n||{},yt=te.features,he=te.getPlugins,Ct=F()(te,ft),Nt=a||{},Tt=Nt.customPreview,Lt=(0,L.useState)(!1),ye=z()(Lt,2),Mt=ye[0],Rt=ye[1],xt=(0,L.useState)(),Ce=z()(xt,2),St=Ce[0],bt=Ce[1],k=(0,L.useRef)(null);(0,L.useImperativeHandle)(o,function(){var U;return{editorRef:k.current,convertToHTML:p.cn,convertFromHtml:(U=k.current)===null||U===void 0?void 0:U.convertFromHtml}});var It=function(){var U=R()(E()().mark(function N(O,H){var Z,V,$,J,Y,G,Q,X,q,ee,Ne;return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(Z=H.onProgress,O){I.next=3;break}return I.abrupt("return",Promise.reject(f.uploadFailed));case 3:return V=0,$=setInterval(function(){V+=1,Z(V),V>=90&&clearInterval($)},100),J=O.size,Y=O.name,G=re()(Y+":"+J+":"+new Date().getTime()).toString(),I.next=9,fetch("".concat(de).concat(pt,"?nosKey=").concat(G,"&bucketName=").concat(Ee));case 9:return Q=I.sent,I.next=12,Q.json();case 12:return X=I.sent,q=X.data,ee=dt({onError:function(){W.Z.error(f.uploadFailed)}}),I.next=17,ot({uploader:ee,file:O,nosKey:G,bucketName:Ee,token:q,nosUrl:ht,trunkSize:Pt});case 17:return Ne=I.sent,I.abrupt("return",{src:Ne});case 19:case"end":return I.stop()}},N)}));return function(O,H){return U.apply(this,arguments)}}(),Ot=function(N){return N.name.length>100?(W.Z.error(f.maxLengthError),!1):N.size>Et?(W.Z.error(f.maxSizeError),!1):ve?ve(N):!0},jt=h()(h()({features:h()({invertWhenPasteSimilarColor:{enable:!0,threshold:.1},fontSize:!0,image:{singleButton:!0,allowEdit:!0},fullScreen:!0},yt||{}),beforeImageUpload:Ot,uploadImage:It},Ct),{},{locale:P[v],getPlugins:function(){var N=[(0,p._C)({getPopoName:it}),(0,p.YV)(),(0,p.SN)(),Ge({customPreview:Tt,ref:k,useTagList:!!(s!=null&&s.length),uiLocale:f}),(0,p._8)(),(0,p.hF)({insertAfter:"IndentDropdown"}),(0,p.zF)({covertNameToSrc:at,insertAfter:"TextBgPicker"})];return s&&N.push(se()),he?he(N):N}}),_t=function(N){var O,H,Z,V=(O=k.current)===null||O===void 0?void 0:O.getEditorState(),$=k==null||(H=k.current)===null||H===void 0||(Z=H.getEditorView)===null||Z===void 0?void 0:Z.call(H),J=$||{},Y=J.dispatch;if(Y){var G=V||{},Q=G.schema,X=G.tr,q=Q.nodes.tag,ee=q.create({name:N.fieldName},null,void 0);X=X.replaceSelectionWith(ee),Y(X)}$==null||$.focus()},Ut=function(N){Rt(!0),u==null||u(N)},Dt=function(N,O){bt(N),e==null||e(N&&(0,p.cn)(N)||"",N,O)};return(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)("div",{className:"bedrock-editor-wrapper",children:[!!s&&(0,M.jsx)(Qe,{tagList:s,onClick:_t,isReady:Mt,uiLocale:f}),(0,M.jsx)(p.ZP,h()(h()({autoFocus:!0},l),{},{editorState:St,onChange:Dt,ref:k,style:h()({"--r-editor-content-font-size":"14px","--r-editor-content-min-height":"240px","--r-editor-content-color":"#333","--text-color-1":"#333","--primary-1":"#1890ff","--br60":"#1890ff"},(l==null?void 0:l.style)||{}),config:jt,onReady:Ut,initialHtml:st(r)}))]})})}var fe=(0,L.forwardRef)(mt),kt=t(49290),wt=function(o,n){var r=o.className,s=o.style,e=o.content,i=o.beforeRenderContent,a=o.useZmage,u=a===void 0?!0:a,d=o.usePopoLink,v=d===void 0?!0:d,l=useRef(null);useImperativeHandle(n,function(){return{element:l.current}});var P=i?i(e):e,x=function(g){g.persist(),u&&g.target.localName==="img"&&Zmage.browsing({src:g.target.currentSrc,backdrop:"rgba(0, 0, 0, 0.5)"})};return useEffect(function(){if(l.current&&v){var f=l.current.querySelectorAll(".popo-link-node");f.forEach(function(g){var b=g.getAttribute("data-email");b&&g.addEventListener("click",function(){window.open("http://popo.netease.com/static/html/open_popo.html?ssid=".concat(b,"&sstp=0"))})})}},[P,v]),_jsx("div",{ref:l,className:"rock-editor__renderer ".concat(r),style:_objectSpread(_objectSpread({},s||{}),{},{"--text-color-1":"#333"}),onClick:x,dangerouslySetInnerHTML:{__html:P}})},Wt=null},86010:function(){}}]);
